# âœ… nginxåå‘ä»£ç†é…ç½®å®Œæˆ 

## ğŸ¯ å½“å‰é…ç½®çŠ¶æ€

âœ… **nginxè¿è¡ŒçŠ¶æ€**: æ­£å¸¸ç›‘å¬80å’Œ443ç«¯å£  
âœ… **DERPæœåŠ¡å™¨**: å†…éƒ¨8443ç«¯å£ï¼Œé€šè¿‡nginxä»£ç†  
âœ… **SSLè¯ä¹¦ç­–ç•¥**: åªä¸ºæœ‰æœ‰æ•ˆè¯ä¹¦çš„åŸŸåæä¾›HTTPS  
âœ… **é»˜è®¤é…ç½®**: åªæä¾›HTTPï¼Œä¸ä½¿ç”¨è‡ªç­¾åè¯ä¹¦  

## ğŸ“‹ ç«¯å£åˆ†é…

| æœåŠ¡ | ç«¯å£ | ç”¨é€” | è®¿é—®æ–¹å¼ |
|------|------|------|----------|
| nginx | 80 | HTTPæœåŠ¡ | å…¬ç½‘è®¿é—® |
| nginx | 443 | HTTPSæœåŠ¡ | å…¬ç½‘è®¿é—®ï¼ˆä»…æœ‰è¯ä¹¦çš„åŸŸåï¼‰ |
| DERP | 8443 | DERPæœåŠ¡ | nginxå†…éƒ¨ä»£ç† |
| STUN | 3478 | UDP STUN | ç›´æ¥å…¬ç½‘è®¿é—® |

## ğŸŒ åŸŸåé…ç½®

### DERPä¸“ç”¨åŸŸå (derp.wedaren.tech)
- âœ… **HTTP**: è‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- âœ… **HTTPS**: é€šè¿‡nginxä»£ç†åˆ°å†…éƒ¨8443ç«¯å£  
- âœ… **è¯ä¹¦**: Let's Encryptæœ‰æ•ˆè¯ä¹¦
- âœ… **åŠŸèƒ½**: å®Œæ•´DERPåè®®æ”¯æŒ

### é»˜è®¤åŸŸå/IPè®¿é—®
- âœ… **HTTP**: æ˜¾ç¤ºnginxçŠ¶æ€é¡µé¢
- âŒ **HTTPS**: ä¸æä¾›ï¼ˆé¿å…è‡ªç­¾åè¯ä¹¦ï¼‰

## ğŸ”§ æœåŠ¡ç®¡ç†

```bash
# nginxæœåŠ¡ç®¡ç†
sudo systemctl status nginx
sudo systemctl restart nginx
sudo nginx -t

# DERPæœåŠ¡ç®¡ç†  
sudo systemctl status derper
sudo systemctl restart derper
sudo journalctl -u derper -f

# æŸ¥çœ‹ç«¯å£ç›‘å¬
sudo ss -tlnp | grep ":80\|:443\|:8443"
```

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

```bash
# æµ‹è¯•DERPæœåŠ¡ï¼ˆé€šè¿‡nginxï¼‰
curl https://derp.wedaren.tech/
curl https://derp.wedaren.tech/derp/probe

# æµ‹è¯•nginxé»˜è®¤ç«™ç‚¹
curl http://47.86.97.218/nginx-status

# æµ‹è¯•nginxå¥åº·æ£€æŸ¥
curl https://derp.wedaren.tech/nginx-health
```

## ğŸŒŸ æ·»åŠ æ–°çš„äºŒçº§åŸŸå

ä½¿ç”¨æä¾›çš„è„šæœ¬æ·»åŠ æ–°ç½‘ç«™ï¼š

```bash
sudo chmod +x add-subdomain.sh
sudo ./add-subdomain.sh
```

æ”¯æŒçš„ç½‘ç«™ç±»å‹ï¼š
1. **é™æ€ç½‘ç«™** - HTML/CSS/JS
2. **åå‘ä»£ç†** - è½¬å‘åˆ°å…¶ä»–ç«¯å£  
3. **PHPç½‘ç«™** - å¸¦PHP-FPMæ”¯æŒ

## ğŸ”’ SSLè¯ä¹¦ç®¡ç†

### ä¸ºæ–°åŸŸåç”³è¯·è¯ä¹¦
```bash
# è‡ªåŠ¨ç”³è¯·å¹¶é…ç½®nginx
sudo certbot --nginx -d your-new-domain.com

# æ‰‹åŠ¨ç”³è¯·
sudo certbot certonly --webroot -w /var/www/html -d your-domain.com
```

### è¯ä¹¦ç»­æœŸ
```bash
# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# è‡ªåŠ¨ç»­æœŸï¼ˆå·²é…ç½®ï¼‰
sudo crontab -l | grep certbot
```

## âœ¨ é…ç½®ä¼˜åŠ¿

1. âœ… **å®‰å…¨**: ä¸ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œé¿å…å®‰å…¨è­¦å‘Š
2. âœ… **çµæ´»**: æ”¯æŒå¤šä¸ªäºŒçº§åŸŸåï¼Œæ¯ä¸ªå¯ç‹¬ç«‹é…ç½®  
3. âœ… **ç»´æŠ¤æ€§**: æ¸…æ™°çš„é…ç½®ç»“æ„ï¼Œæ˜“äºç®¡ç†
4. âœ… **æ‰©å±•æ€§**: å¯è½»æ¾æ·»åŠ æ–°çš„ç½‘ç«™å’ŒæœåŠ¡
5. âœ… **ä¸“ä¸š**: ç¬¦åˆç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

## ğŸ‰ ç°åœ¨æ‚¨å¯ä»¥

1. **DERPæœåŠ¡æ­£å¸¸è¿è¡Œ**: https://derp.wedaren.tech
2. **æ·»åŠ å…¶ä»–ç½‘ç«™**: ä½¿ç”¨ `add-subdomain.sh` è„šæœ¬
3. **ä¸ºæ–°åŸŸåç”³è¯·è¯ä¹¦**: ä½¿ç”¨ `certbot --nginx`
4. **è®¿é—®nginxçŠ¶æ€**: http://æ‚¨çš„IP/nginx-status

nginxåå‘ä»£ç†é…ç½®å®Œæˆï¼Œç«¯å£80å’Œ443ç°åœ¨ç”±nginxç»Ÿä¸€ç®¡ç†ï¼ğŸš€
